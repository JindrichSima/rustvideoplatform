<!DOCTYPE html>
<html>

<head>
    {% include "component-dependencies.html" %}
    <title>Upload</title>

    <meta property="og:title" content="{{ config.instancename }} Upload" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://{{ common_headers.host }}/upload" />
</head>

<body>
    {{ sidebar }}
    {% include "component-navbar.html" %}
    <div class="row maincontentrow g-3 py-2 ps-2" style="max-width: 99%;">
        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
            <div class="card py-3 px-3 text-white" style="min-height: 80vh;">
                <h3 class="my-2 mx-3">Upload</h3>
                <hr>
                <h1 class="m-3 text-center">What do you want to upload today?</h1>
                <div class="d-flex justify-content-center">
                    <div></div>
                    <div>
                        <input type="file" id="fileInput" />
                        <button onclick="uploadFile()">Upload File</button>
                        <div id="uploadProgress"></div>

                        <script>
                            async function uploadFile() {
                                const file = document.getElementById('fileInput').files[0];
                                if (!file) {
                                    alert('Please select a file to upload.');
                                    return;
                                }

                                const chunkSize = 5 * 1024 * 1024; // 5MB per chunk
                                const totalChunks = Math.ceil(file.size / chunkSize);

                                for (let i = 0; i < totalChunks; i++) {
                                    const chunk = file.slice(i * chunkSize, (i + 1) * chunkSize);
                                    const formData = new FormData();
                                    formData.append('chunk', chunk);
                                    formData.append('chunk_index', i);
                                    formData.append('total_chunks', totalChunks);

                                    await fetch("/upload?file_name=${encodeURIComponent(file.name)}", {
                                        method: 'POST',
                                        body: formData
                                    });

                                    document.getElementById('uploadProgress').innerText = "Uploaded chunk ${i + 1} of ${totalChunks}";
                                }

                                alert('File uploaded successfully!');
                            }
                        </script>

                    </div>
                    <div></div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>